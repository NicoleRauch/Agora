extends ../../../views/layoutOnlyMain
include ../../activities/views/activities-mixins
include ../../mailarchive/views/mailheader-mixin

block scripts
  script.
    $(document).ready(function () {
      $('a.chevron').click(function() {$(this).find('i').toggleClass('fa-toggle-down fa-toggle-right')});
    });

block title
  | Dashboard
block content
  .row
    .col-sm-6
      +my_activities
    .col-sm-6
      .well: p Hier muss dann nochmal was sein
  +my_groups

mixin my_groups
  -var n = member.subscribedGroups.length
  .row
    -for(var i = 0; i < 3; i += 1)
      if (i <= n)
        .col-sm-4
          -for(var j = i; j < n; j += 3)
            -var group = member.subscribedGroups[j]
              -var panelid = group.id + '-grouppanel'
              .panel.panel-default
                .panel-heading(style="background-color: #{group.color}; color: #FFFFFF;")
                  a.inherit-color.chevron(data-toggle="collapse", data-target="##{panelid}"): b
                    i.fa.fa-toggle-down.fa-fw.blog
                  | &nbsp;#{group.longName}
                  a.inherit-color(href="/groups/#{group.id}"): span.pull-right: i.fa.fa-group.fa-fw.tooltipify(data-toggle="tooltip" title="Go to group.")
                .panel-body.collapse.in(id="#{panelid}")
                  +wikichangesOrBlogs(postsByGroup[group.id], panelid, 'blogs', 'Blogposts')
                  +wikichangesOrBlogs(changesByGroup[group.id], panelid, 'changes', 'Wiki-Changes')
                  if (mailsByGroup[group.id].length > 0)
                    h5
                      a.chevron(data-toggle="collapse", data-target="##{panelid} .mails")
                        i.fa.fa-toggle-down.fa-fw.blog
                      | &nbsp;Latest from Mailarchive
                    .mails.collapse.in
                      +mailIndex(mailsByGroup[group.id])

mixin my_activities
  .panel.panel-default
    .panel-heading
      b Kommende AktivitÃ¤ten
    ul.list-group
      each activity in activities
        -var angemeldet = (member && activity.allRegisteredMembers().indexOf(member.id()) > -1)
        li.list-group-item
          if (angemeldet)
            i.fa.fa-check.fa-fw.text-success.tooltipify(data-toggle="tooltip" title="Du bist angemeldet.")
          else
            i.fa.fa-question.fa-fw.tooltipify(data-toggle="tooltip" title="Du bist nicht angemeldet.")
          | &nbsp; #{activity.startMoment().lang(language).format('L')} &nbsp; 
          a(href='/activities/#{encodeURIComponent(activity.url())}') #{activity.title()}
          span.pull-right(style="color: #{activity.colorRGB};") #{activity.groupName()}

mixin wikichangesOrBlogs(items, panelid, prefix, title)
  if (items.length > 0)
    h5
      a.chevron(data-toggle="collapse", data-target="##{panelid} .#{prefix}")
        i.fa.fa-toggle-down.fa-fw.blog
      | &nbsp;#{title}
    div(class="#{prefix} collapse in")
      ul.list-unstyled
        each item in items
          li
            div(id="#{item.dialogId()}", tabindex="-1").modal.fade.bs-modal-lg
              .modal-dialog.modal-lg
                .modal-content
            a(data-toggle="modal", data-target="##{item.dialogId()}", href="#{item.dialogUrl()}") #{item.pureName()}
            small.pull-right #{item.date().lang(language).format('L')}&nbsp;
              a(href="#{item.url()}"): i.fa.fa-book.fa-fw.tooltipify(data-toggle="tooltip" title="Go to item's page.")
    hr
